name: Real Hourly Scraper

on:
  schedule:
    # Runs at minute 15 past every hour (e.g. 1:15, 2:15)
    # We choose :15 to avoid 'rush hour' on free servers
    - cron: '15 * * * *'
  workflow_dispatch: # Allows manual trigger button

jobs:
  scrape-and-update:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        # This installs everything listed in your requirements.txt
        # (Make sure apify-client and google-generativeai are in that file!)
        run: |
          pip install -r requirements.txt

      - name: Run Sentinel Engine
        env:
          # Pass all 4 keys to the script
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
          APIFY_TOKEN: ${{ secrets.APIFY_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: python sentiment_engine.py
